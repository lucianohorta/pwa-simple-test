<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hello World PWA + Push Notifications</title>

<!-- Manifest -->
<link rel="manifest" href="/manifest.json" />
<link rel="icon" href="/icon-192.png" />
<link rel="apple-touch-icon" href="/icon-192.png" />

<!-- PWA meta -->
<meta name="theme-color" content="#ffffff" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content="Lembretes" />

<link rel="stylesheet" href="/style.css" />
</head>
<body>
<h1>Hello World PWA + Push Notifications</h1>
<button id="subscribe">Enable Push Notification</button>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-messaging-compat.js"></script>

<script>
    const firebaseConfig = {
    apiKey: "AIzaSyBk_c4KxIWghSZYWiTesJP4Ho9XXdp4XWs",
    authDomain: "pwa-ios-bba82.firebaseapp.com",
    projectId: "pwa-ios-bba82",
    storageBucket: "pwa-ios-bba82.appspot.com",
    messagingSenderId: "894142973830",
    appId: "1:894142973830:web:2f124ebbd5e183b7b58e07",
    measurementId: "G-5R46BB6M38"
    };

    firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();

    if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/firebase-messaging-sw.js')
        .then(function(registration) {
        console.log('Service Worker registrado com sucesso', registration);

        document.getElementById('subscribe').addEventListener('click', async () => {
            try {
            const permission = await Notification.requestPermission();
            if (permission === 'granted') {
                const token = await messaging.getToken({
                vapidKey: 'BOyQvrJPgC9d-mEncQGz93pEbhB1IghXhgln42SBx3BVhCkO6JwWMA1MSYVdCMRiA_BpspdWvnJDXgeP91o-vNA',
                serviceWorkerRegistration: registration
                });

                console.log('Token:', token);

                const res = await fetch('/api/save-token', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token })
                });

                if (res.ok) {
                alert('Token salvo com sucesso!');
                } else {
                alert('Token gerado, mas houve erro ao salvar no servidor.');
                }
            } else {
                alert('Permissão negada.');
            }
            } catch (error) {
            console.error('Erro ao ativar notificações', error);
            alert('Erro ao ativar notificações');
            }
        });
        })
        .catch(function(err) {
        console.error('Erro ao registrar o Service Worker', err);
        });
    }
</script>
</body>
</html>
