<!DOCTYPE html>
<html lang="en">
<head>
<!-- Your existing head content -->
</head>
<body>
<h1>Hello World PWA + Push Notifications</h1>
<button id="subscribe">Enable Push Notification</button>
<div id="status"></div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-messaging-compat.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
    const firebaseConfig = {
        apiKey: "AIzaSyBk_c4KxIWghSZYWiTesJP4Ho9XXdp4XWs",
        authDomain: "pwa-ios-bba82.firebaseapp.com",
        projectId: "pwa-ios-bba82",
        storageBucket: "pwa-ios-bba82.firebasestorage.app",
        messagingSenderId: "894142973830",
        appId: "1:894142973830:web:2f124ebbd5e183b7b58e07"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging(app);
    const statusElement = document.getElementById('status');

    // Register service worker
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/firebase-messaging-sw.js')
        .then(registration => {
            console.log('SW registered');
            
            // Handle button click
            document.getElementById('subscribe').addEventListener('click', async () => {
            try {
                // Request permission
                const permission = await Notification.requestPermission();
                
                if (permission === 'granted') {
                statusElement.textContent = 'Getting token...';
                
                // Get FCM token
                const token = await messaging.getToken({
                    serviceWorkerRegistration: registration,
                    vapidKey: "BOyQvrJPgC9d-mEncQGz93pEbhB1IghXhgln42SBx3BVhCkO6JwWMA1MSYVdCMRiA_BpspdWvnJDXgeP91o-vNA"
                });
                
                statusElement.textContent = 'Token received!';
                console.log('FCM Token:', token);
                
                // Send token to your backend
                const response = await fetch('/api/save-token', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token })
                });
                
                if (response.ok) {
                    statusElement.textContent = 'Push notifications enabled!';
                } else {
                    statusElement.textContent = 'Failed to save token';
                }
                } else {
                statusElement.textContent = 'Permission denied';
                console.warn('Notification permission:', permission);
                }
            } catch (error) {
                console.error('Error:', error);
                statusElement.textContent = 'Error: ' + error.message;
            }
            });
        })
        .catch(error => {
            console.error('SW registration failed:', error);
            statusElement.textContent = 'Service worker failed to register';
        });
    } else {
        statusElement.textContent = 'Service workers not supported';
    }
    });
</script>
</body>
</html>